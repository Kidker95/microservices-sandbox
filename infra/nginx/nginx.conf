events {}

http {
  server {
    listen 8080;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Upgrade $http_upgrade;

    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    location = /health {
      return 200 "nginx ok\n";
      add_header Content-Type text/plain;
    }

    # Pretty health aliases (exact match)
    location = /api/users/health    { proxy_pass http://127.0.0.1:4001/health; }
    location = /api/orders/health   { proxy_pass http://127.0.0.1:4002/health; }
    location = /api/products/health { proxy_pass http://127.0.0.1:4003/health; }
    location = /api/receipts/health { proxy_pass http://127.0.0.1:4004/health; }
    location = /api/admin/health    { proxy_pass http://127.0.0.1:4005/health; }
    location = /api/fortune/health    { proxy_pass http://127.0.0.1:4006/health; }

    # Pretty API routes (keep path as-is)
    location /api/users/    { proxy_pass http://127.0.0.1:4001; }
    location /api/orders/   { proxy_pass http://127.0.0.1:4002; }
    location /api/products/ { proxy_pass http://127.0.0.1:4003; }
    location /api/receipts/ { proxy_pass http://127.0.0.1:4004; }
    location /api/fortune/ { proxy_pass http://127.0.0.1:4006; }

    # Admin
    location /admin/     { proxy_pass http://127.0.0.1:4005; }
    location /api/admin/ { proxy_pass http://127.0.0.1:4005; }

    location / {
      return 404 "Unknown route\n";
    }
  }
}
